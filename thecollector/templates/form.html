{% extends "layout.html" %}
{% block content %}
    <div class="alert alert-danger">
        WIP: FACE ONLY VERSION! There is basically no back to this so whatever you do, do NOT submit or play around.
        <br>
        Just take a look and stay tuned.
    </div>
    <form method="{{ method if method else 'POST' }}" action="{{ action if action else '' }}" autocomplete="off">
        {{ form.hidden_tag() }}
        <div class="form-floating mb-3">
            {{ form.title(placeholder="Optional title for your content...", class="form-control") }}
            {{ form.title.label() }}
        </div>
        <div class="form-floating mb-3">
            {% if form.context.errors %}
                {{ form.context(placeholder="Some story here...", class="is-invalid form-control h-auto", aria_describedby="%sfeedback"%form.context.id) }}
                <div id="{{ form.context.id }}feedback" class="d-block invalid-feedback">
                    {% for error in form.context.errors %}
                        <span>{{ error }}</span>&nbsp;
                    {% endfor %}
                </div>
            {% else %}
                {{ form.context(placeholder="Some story here...", class="form-control h-auto") }}
            {% endif %}
            {{ form.context.label() }}
        </div>
        {% for pair in form.pairs %}
            <div class="mt-3">
                <div class="form-floating mb-1">
                    {% if pair.question.errors %}
                        {{ pair.question(placeholder="What when happened?", class="is-invalid form-control", aria_describedby="%sfeedback"%pair.question.id) }}
                        <div id="{{ pair.question.id }}feedback" class="d-block invalid-feedback">
                            {% for error in pair.question.errors %}
                                <span>{{ error }}</span>&nbsp;
                            {% endfor %}
                        </div>
                    {% else %}
                        {{ pair.question(placeholder="What when happened?", class="form-control") }}
                    {% endif %}
                    {{ pair.question.label(text="{} {}".format(pair.question.label.text, loop.index)) }}
                </div>
                {% if pair.text is defined %}
                    <div class="form-floating mb-1">
                        {% if pair.text.errors %}
                            {{ pair.text(placeholder="This is when what happened.", class="is-invalid form-control", aria_describedby="answer_1sfeedback") }}
                        {% else %}
                            {{ pair.text(placeholder="What when happened?", class="form-control") }}
                        {% endif %}
                        {{ pair.text.label(text="{} {}".format(pair.text.label.text, loop.index)) }}
                    </div>
                    <div class="input-group flat-top">
                        {{ pair.start.label(class="input-group-text square-top-left", text="{} {}".format(pair.start.label.text, loop.index)) }}
                        {% if pair.start.errors %}
                            {{ pair.start(placeholder="9", class="is-invalid form-control", aria_describedby="answer_1sfeedback") }}
                        {% else %}
                            {{ pair.start(placeholder="9", class="form-control") }}
                        {% endif %}
                        {{ pair.end.label(class="input-group-text", text="{} {}".format(pair.end.label.text, loop.index)) }}
                        {% if pair.start.errors %}
                            {{ pair.end(placeholder="42", class="is-invalid form-control square-top-right", aria_describedby="answer_1sfeedback") }}
                        {% else %}
                            {{ pair.end(placeholder="42", class="form-control square-top-right") }}
                        {% endif %}
                    </div>
                    {% if pair.text.errors or pair.start.errors or pair.end.errors %}
                        <div id="answer_1sfeedback" class="d-block invalid-feedback">
                            {% for error in pair.text.errors %}
                                <span>{{ error }}</span>&nbsp;
                            {% endfor %}
                            {% for error in pair.start.errors %}
                                <span>{{ error }}</span>&nbsp;
                            {% endfor %}
                            {% for error in pair.end.errors %}
                                <span>{{ error }}</span>&nbsp;
                            {% endfor %}
                        </div>
                    {% endif %}
                    <span id="tip" class="text-muted d-none my-2">tip: selected <em id="tipline"></em></span>
                {% endif %}
            </div>
        {% endfor %}
        {{ form.submit(class="btn btn-lg btn-success px-max mt-3 w-100") }}
    </form>
    <div class="my-4">
        {# <a href="{{ url_for('dump') }}" class="btn btn-info w-100 mb-3">Dump Database</a> #}
        <button id="rtl" type="button" class="btn btn-secondary float-end" data-bs-toggle="button" autocomplete="off" aria-pressed="false">Toggle RTL</button>
    </div>
{% endblock content %}

{% block scripts %}
    <script type="text/javascript">
        // RTL switch
        let rtlbtn = document.getElementById('rtl');
        let html = document.querySelector('html');
        document.addEventListener('DOMContentLoaded', function() {
            if (html.getAttribute("dir") == "rtl") {
                rtlbtn.setAttribute("aria-pressed", "true");
                rtlbtn.classList.add("active");
            } else {
                html.setAttribute("dir", "ltr");
                rtlbtn.setAttribute("aria-pressed", "false");
                rtlbtn.classList.remove("active");
            }
        }, false);
        rtlbtn.onclick = function() {
            if (rtlbtn.getAttribute("aria-pressed") == "true") {
                html.setAttribute("dir", "ltr");
                rtlbtn.setAttribute("aria-pressed", "false");
                rtlbtn.classList.remove("active");
            } else {
                html.setAttribute("dir", "rtl");
                rtlbtn.setAttribute("aria-pressed", "true");
                rtlbtn.classList.add("active");
            }
        }
    </script>
{% endblock scripts %}

{% block style %}
    textarea {
        resize: none;
    }
    .square-top {
        border-top-right-radius: 0;
        border-top-left-radius: 0;
    }
    html[dir="rtl"] .square-top-right {
        border-top-left-radius: 0;
    }
    html[dir="rtl"] .square-top-left {
        border-top-right-radius: 0;
    }
    .square-top-left {
        border-top-left-radius: 0;
    }
    .square-top-right {
        border-top-right-radius: 0;
    }
    .square-bottom {
        border-bottom-right-radius: 0;
        border-bottom-left-radius: 0;
    }
    input::-webkit-outer-spin-button,
    input::-webkit-inner-spin-button,
    input[type=number] {
        -webkit-appearance: none;
        -moz-appearance: textfield;
        margin: 0;
    }
{% endblock style %}
